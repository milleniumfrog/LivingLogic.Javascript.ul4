var ul4Lib=function(_){"use strict";var n,L,Y=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),N=Date;return function(i){i._havemap="function"==typeof Map&&"function"==typeof Map.prototype.forEach;!function(){if(i._havemap)try{if(1==new Map([[1,2]]).size)return}catch(t){}}();var t="function"==typeof Set&&"function"==typeof Set.prototype.forEach;i._havemap;i._setmap=i._havemap?function(t,e,r){t.set(e,r)}:function(t,e,r){t[e]=r},i._emptymap=i._havemap?function(){return new Map}:function(){return{}};i._havemap;i._emptyset=t?function(){return new Set}:function(){return new _.ul4._Set},i._makeset=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=i._emptymap(),n=0,u=t;n<u.length;n++){var o=u[n];r.add(o)}return r}}(L||(L={})),function(b){var e=1;b._update=function(r,t,e){if(!b._isdict(r))throw new b.TypeError("update() requires a dict");for(var n=0,u=t;n<u.length;n++){var o=u[n];if(b._ismap(o))o.forEach(function(t,e){L._setmap(r,e,t)});else if(b._isobject(o))for(var i in o)L._setmap(r,i,o[i]);else{if(!b._islist(o))throw new b.TypeError("update() requires a dict or a list of (key, value) pairs");for(var a=0,s=o;a<s.length;a++){var f=s[a];if(!b._islist(f)||2!=f.length)throw new b.TypeError("update() requires a dict or a list of (key, value) pairs");L._setmap(r,f[0],f[1])}}}return e.forEach(function(t,e){L._setmap(r,e,t)}),null},b._hls=function(t,e,r,n){var u,o,i=function(t,e,r){return(r%=1)<1/6?t+(e-t)*r*6:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t};return void 0===n&&(n=1),0===r?b._rgb(e,e,e,n):(u=2*e-(o=e<=.5?e*(1+r):e+r-e*r),b._rgb(i(u,o,t+1/3),i(u,o,t),i(u,o,t-1/3),n))},b._rgb=function(t,e,r,n){return new b.Color(255*t,255*e,255*r,255*n)},b._date=function(t,e,r){return new b.Date(t,e,r)},b._isleap=function(t){return 1===new N(t.getFullYear(),1,29).getMonth()},b._formatsource=function(t){for(var e=[],r=0,n=!1,u=0,o=t;u<o.length;u++){var i=o[u];if("number"==typeof i)r+=i,n=!0;else{if(n){e.push("\n");for(var a=0;a<r;++a)e.push("\t");n=!1}e.push(i)}}return n&&e.push("\n"),e.join("")},b._mod=function(t,e){var r=Math.floor(t/e),n=t-r*e;return 0!==n&&(e<0&&0<n||0<e&&n<0)&&(n+=e,--r),t-r*e},b._unorderable=function(t,e,r){throw new b.TypeError("unorderable types: "+b._type(e)+" "+t+" "+b._type(r))},b.expose=function(t,e,r){var n;(r=r||{}).name&&(t._ul4_name=r.name),b._islist(e)&&(e=new((n=b.Signature).bind.apply(n,[void 0].concat(e)))),t._ul4_signature=e,t._ul4_needsobject=r.needsobject||!1,t._ul4_needscontext=r.needscontext||!1},b._find=function(t,e,r,n){void 0===r&&(r=null),void 0===n&&(n=null),null===r&&(r=0),null===n&&(n=t.length||0),r<0&&(r+=t.length),n<0&&(n+=t.length),r=b._bound(r,t.length),n=b._bound(n,t.length),0===r&&n===t.length||(t="string"==typeof t?t.substring(r,n):t.slice(r,n));var u=t.indexOf(e);return-1!==u&&(u+=r),u},b._eq=function(r,n){var t=["boolean","number"];if(r&&"function"==typeof r.__eq__)return r.__eq__(n);if(n&&"function"==typeof n.__eq__)return n.__eq__(r);if(null===r)return null===n;if(-1!=t.indexOf(typeof r))return-1!=t.indexOf(typeof n)&&r==n;if("string"==typeof r)return"string"==typeof n&&r==n;if(b._isdatetime(r))return!!b._isdatetime(n)&&r.getTime()==n.getTime();if(b._islist(r)){if(b._islist(n)){if(r===n)return!0;if(r.length!=n.length)return!1;for(var e=0;e<r.length;++e)if(!b._eq(r[e],n[e]))return!1;return!0}return!1}if(b._isobject(r)){if(b._isobject(n)){if(r===n)return!0;for(var u in r){if(!n.hasOwnProperty(u))return!1;if(!b._eq(r[u],n[u]))return!1}for(var u in n)if(!r.hasOwnProperty(u))return!1;return!0}if(b._ismap(n)){for(var u in r){if(!n.has(u))return!1;if(!b._eq(r[u],n.get(u)))return!1}var o=!0;return n.forEach(function(t,e){r.hasOwnProperty(e)||(o=!1)}),o}return!1}if(b._ismap(r)){if(b._isobject(n)){var i=!0;if(r.forEach(function(t,e){i&&(n.hasOwnProperty(e)&&b._eq(r.get(e),n[e])||(i=!1))}),!i)return!1;for(var u in n)if(!r.has(u))return!1;return!0}if(b._ismap(n)){if(r===n)return!0;if(r.size!=n.size)return!1;var a=!0;return r.forEach(function(t,e){a&&(n.has(e)&&b._eq(r.get(e),n.get(e))||(a=!1))}),a}return!1}if(b._isset(r)){if(b._isset(n)){if(r===n)return!0;if(r.size!=n.size)return!1;var s=!0;return r.forEach(function(t){s&&(n.has(t)||(s=!1))}),s}return!1}return r===n},b._bound=function(t,e){return t<0?0:e<t?e:t},b._count=function(t,e,r,n){if(void 0===r&&(r=null),void 0===n&&(n=null),null===r&&(r=0),r<0&&(r+=t.length),null===n&&(n=t.length||0),n<0&&(n+=t.length),b._isstr(t)&&!e.length){if(n<0||r>t.length||n<r)return 0;var u=n-r+1;return u>t.length+1&&(u=t.length+1),u}r=b._bound(r,t.length),n=b._bound(n,t.length);var o=0;if(b._islist(t)){for(var i=r;i<n;++i)b._eq(t[i],e)&&++o;return o}for(var a=r;-1!=(a=t.indexOf(e,a))&&!(a+e.length>n);)++o,a+=e.length;return o},b._isul4set=function(t){return t instanceof b._Set},b._isstr=function(t){return"string"==typeof t},b._iscolor=function(t){return t instanceof b.Color},b._isdate=function(t){return t instanceof b.Date},b._isdatetime=function(t){return"[object Date]"==Object.prototype.toString.call(t)},b._istimedelta=function(t){return t instanceof b.TimeDelta},b._ismonthdelta=function(t){return t instanceof b.MonthDelta},b._islist=function(t){return"[object Array]"==Object.prototype.toString.call(t)},b._ismap=function(t){return null!==t&&"object"==typeof t&&"object"==typeof t.__proto__&&t.__proto__===Map.prototype},b._isdict=function(t){return b._isobject(t)||b._ismap(t)},b._isset=function(t){return"[object Set]"==Object.prototype.toString.call(t)},b._isobject=function(t){return"[object Object]"==Object.prototype.toString.call(t)&&void 0===t.__type__&&!(t instanceof b.Proto)},b._isiter=function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.next},b._repr=function(t){return b._repr_internal(t,!1)},b._repr_internal=function(t,e){return null===t?"None":!1===t?"False":!0===t?"True":"string"==typeof t?b._str_repr(t,e):"number"==typeof t?""+t:"function"==typeof t?t._ul4_name||t.name?"<function "+(t._ul4_name||t.name)+">":"<anonymous function>":b._isdate(t)?b._date_repr(t,e):b._isdatetime(t)?b._datetime_repr(t,e):void 0===t?"<undefined>":"object"==typeof t&&"function"==typeof t.__repr__?t.__repr__():b._islist(t)?b._list_repr(t,e):b._ismap(t)?b._map_repr(t,e):b._isset(t)?b._set_repr(t,e):b._isobject(t)?b._object_repr(t,e):"?"},b._object_repr=function(t,e){void 0===e&&(e=!1);var r=[];r.push("{");var n=0;for(var u in t)t.hasOwnProperty(u)&&(n++&&r.push(", "),r.push(b._repr_internal(u,e)),r.push(": "),r.push(b._repr_internal(t[u],e)));return r.push("}"),r.join("")},b._set_repr=function(t,r){void 0===r&&(r=!1);var n=[];if(n.push("{"),t.size){var u=0;t.forEach(function(t,e){u++&&n.push(", "),n.push(b._repr_internal(t,r))})}else n.push("/");return n.push("}"),n.join("")},b._map_repr=function(t,r){void 0===r&&(r=!1);var n=[];n.push("{");var u=0;return t.forEach(function(t,e){u++&&n.push(", "),n.push(b._repr_internal(e,r)),n.push(": "),n.push(b._repr_internal(t,r))}),n.push("}"),n.join("")},b._list_repr=function(t,e){void 0===e&&(e=!1);var r=[];r.push("[");for(var n=0;n<t.length;++n)0!==n&&r.push(", "),r.push(b._repr_internal(t[n],e));return r.push("]"),r.join("")},b._datetime_repr=function(t,e){void 0===e&&(e=!1);var r=t.getFullYear(),n=t.getMonth()+1,u=t.getDate(),o=t.getHours(),i=t.getMinutes(),a=t.getSeconds(),s=t.getMilliseconds(),f="@("+r+"-"+b._lpad(n.toString(),"0",2)+"-"+b._lpad(u.toString(),"0",2)+"T";return(o||i||a||s)&&(f+=b._lpad(o.toString(),"0",2)+":"+b._lpad(i.toString(),"0",2),(a||s)&&(f+=":"+b._lpad(a.toString(),"0",2),s&&(f+="."+b._lpad(s.toString(),"0",3)+"000"))),f+=")"},b._date_repr=function(t,e){void 0===e&&(e=!1);var r=t._date,n=r.getFullYear(),u=r.getMonth()+1,o=r.getDate();return"@("+n+"-"+b._lpad(u.toString(),"0",2)+"-"+b._lpad(o.toString(),"0",2)+")"},b._str_repr=function(t,e){void 0===e&&(e=!1);for(var r="",n=!1,u=!1,o=0,i=t;o<i.length;o++)if('"'==(l=i[o])){if(u=!0,n)break}else if("'"==l&&(n=!0,u))break;for(var a=n&&!u?'"':"'",s=0,f=t;s<f.length;s++){var l;switch(l=f[s]){case'"':r+=a==l?'\\"':l;break;case"'":r+=a==l?"\\'":l;break;case"\\":r+="\\\\";break;case"\t":r+="\\t";break;case"\n":r+="\\n";break;case"\r":r+="\\r";break;default:var c=l.charCodeAt(0),p=void 0;r+=0==(p=c<32?2:c<127?0:e||/[\u007f-\u00a0\u00ad\u0378-\u0379\u0380-\u0383\u038b\u038d\u03a2\u0530\u0557-\u0558\u0560\u0588\u058b-\u058c\u0590\u05c8-\u05cf\u05eb-\u05ef\u05f5-\u0605\u061c-\u061d\u06dd\u070e-\u070f\u074b-\u074c\u07b2-\u07bf\u07fb-\u07ff\u082e-\u082f\u083f\u085c-\u085d\u085f-\u089f\u08b5-\u08e2\u0984\u098d-\u098e\u0991-\u0992\u09a9\u09b1\u09b3-\u09b5\u09ba-\u09bb\u09c5-\u09c6\u09c9-\u09ca\u09cf-\u09d6\u09d8-\u09db\u09de\u09e4-\u09e5\u09fc-\u0a00\u0a04\u0a0b-\u0a0e\u0a11-\u0a12\u0a29\u0a31\u0a34\u0a37\u0a3a-\u0a3b\u0a3d\u0a43-\u0a46\u0a49-\u0a4a\u0a4e-\u0a50\u0a52-\u0a58\u0a5d\u0a5f-\u0a65\u0a76-\u0a80\u0a84\u0a8e\u0a92\u0aa9\u0ab1\u0ab4\u0aba-\u0abb\u0ac6\u0aca\u0ace-\u0acf\u0ad1-\u0adf\u0ae4-\u0ae5\u0af2-\u0af8\u0afa-\u0b00\u0b04\u0b0d-\u0b0e\u0b11-\u0b12\u0b29\u0b31\u0b34\u0b3a-\u0b3b\u0b45-\u0b46\u0b49-\u0b4a\u0b4e-\u0b55\u0b58-\u0b5b\u0b5e\u0b64-\u0b65\u0b78-\u0b81\u0b84\u0b8b-\u0b8d\u0b91\u0b96-\u0b98\u0b9b\u0b9d\u0ba0-\u0ba2\u0ba5-\u0ba7\u0bab-\u0bad\u0bba-\u0bbd\u0bc3-\u0bc5\u0bc9\u0bce-\u0bcf\u0bd1-\u0bd6\u0bd8-\u0be5\u0bfb-\u0bff\u0c04\u0c0d\u0c11\u0c29\u0c3a-\u0c3c\u0c45\u0c49\u0c4e-\u0c54\u0c57\u0c5b-\u0c5f\u0c64-\u0c65\u0c70-\u0c77\u0c80\u0c84\u0c8d\u0c91\u0ca9\u0cb4\u0cba-\u0cbb\u0cc5\u0cc9\u0cce-\u0cd4\u0cd7-\u0cdd\u0cdf\u0ce4-\u0ce5\u0cf0\u0cf3-\u0d00\u0d04\u0d0d\u0d11\u0d3b-\u0d3c\u0d45\u0d49\u0d4f-\u0d56\u0d58-\u0d5e\u0d64-\u0d65\u0d76-\u0d78\u0d80-\u0d81\u0d84\u0d97-\u0d99\u0db2\u0dbc\u0dbe-\u0dbf\u0dc7-\u0dc9\u0dcb-\u0dce\u0dd5\u0dd7\u0de0-\u0de5\u0df0-\u0df1\u0df5-\u0e00\u0e3b-\u0e3e\u0e5c-\u0e80\u0e83\u0e85-\u0e86\u0e89\u0e8b-\u0e8c\u0e8e-\u0e93\u0e98\u0ea0\u0ea4\u0ea6\u0ea8-\u0ea9\u0eac\u0eba\u0ebe-\u0ebf\u0ec5\u0ec7\u0ece-\u0ecf\u0eda-\u0edb\u0ee0-\u0eff\u0f48\u0f6d-\u0f70\u0f98\u0fbd\u0fcd\u0fdb-\u0fff\u10c6\u10c8-\u10cc\u10ce-\u10cf\u1249\u124e-\u124f\u1257\u1259\u125e-\u125f\u1289\u128e-\u128f\u12b1\u12b6-\u12b7\u12bf\u12c1\u12c6-\u12c7\u12d7\u1311\u1316-\u1317\u135b-\u135c\u137d-\u137f\u139a-\u139f\u13f6-\u13f7\u13fe-\u13ff\u1680\u169d-\u169f\u16f9-\u16ff\u170d\u1715-\u171f\u1737-\u173f\u1754-\u175f\u176d\u1771\u1774-\u177f\u17de-\u17df\u17ea-\u17ef\u17fa-\u17ff\u180e-\u180f\u181a-\u181f\u1878-\u187f\u18ab-\u18af\u18f6-\u18ff\u191f\u192c-\u192f\u193c-\u193f\u1941-\u1943\u196e-\u196f\u1975-\u197f\u19ac-\u19af\u19ca-\u19cf\u19db-\u19dd\u1a1c-\u1a1d\u1a5f\u1a7d-\u1a7e\u1a8a-\u1a8f\u1a9a-\u1a9f\u1aae-\u1aaf\u1abf-\u1aff\u1b4c-\u1b4f\u1b7d-\u1b7f\u1bf4-\u1bfb\u1c38-\u1c3a\u1c4a-\u1c4c\u1c80-\u1cbf\u1cc8-\u1ccf\u1cf7\u1cfa-\u1cff\u1df6-\u1dfb\u1f16-\u1f17\u1f1e-\u1f1f\u1f46-\u1f47\u1f4e-\u1f4f\u1f58\u1f5a\u1f5c\u1f5e\u1f7e-\u1f7f\u1fb5\u1fc5\u1fd4-\u1fd5\u1fdc\u1ff0-\u1ff1\u1ff5\u1fff-\u200f\u2028-\u202f\u205f-\u206f\u2072-\u2073\u208f\u209d-\u209f\u20bf-\u20cf\u20f1-\u20ff\u218c-\u218f\u23fb-\u23ff\u2427-\u243f\u244b-\u245f\u2b74-\u2b75\u2b96-\u2b97\u2bba-\u2bbc\u2bc9\u2bd2-\u2beb\u2bf0-\u2bff\u2c2f\u2c5f\u2cf4-\u2cf8\u2d26\u2d28-\u2d2c\u2d2e-\u2d2f\u2d68-\u2d6e\u2d71-\u2d7e\u2d97-\u2d9f\u2da7\u2daf\u2db7\u2dbf\u2dc7\u2dcf\u2dd7\u2ddf\u2e43-\u2e7f\u2e9a\u2ef4-\u2eff\u2fd6-\u2fef\u2ffc-\u3000\u3040\u3097-\u3098\u3100-\u3104\u312e-\u3130\u318f\u31bb-\u31bf\u31e4-\u31ef\u321f\u32ff\u4db6-\u4dbf\u9fd6-\u9fff\ua48d-\ua48f\ua4c7-\ua4cf\ua62c-\ua63f\ua6f8-\ua6ff\ua7ae-\ua7af\ua7b8-\ua7f6\ua82c-\ua82f\ua83a-\ua83f\ua878-\ua87f\ua8c5-\ua8cd\ua8da-\ua8df\ua8fe-\ua8ff\ua954-\ua95e\ua97d-\ua97f\ua9ce\ua9da-\ua9dd\ua9ff\uaa37-\uaa3f\uaa4e-\uaa4f\uaa5a-\uaa5b\uaac3-\uaada\uaaf7-\uab00\uab07-\uab08\uab0f-\uab10\uab17-\uab1f\uab27\uab2f\uab66-\uab6f\uabee-\uabef\uabfa-\uabff\ud7a4-\ud7af\ud7c7-\ud7ca\ud7fc-\uf8ff\ufa6e-\ufa6f\ufada-\ufaff\ufb07-\ufb12\ufb18-\ufb1c\ufb37\ufb3d\ufb3f\ufb42\ufb45\ufbc2-\ufbd2\ufd40-\ufd4f\ufd90-\ufd91\ufdc8-\ufdef\ufdfe-\ufdff\ufe1a-\ufe1f\ufe53\ufe67\ufe6c-\ufe6f\ufe75\ufefd-\uff00\uffbf-\uffc1\uffc8-\uffc9\uffd0-\uffd1\uffd8-\uffd9\uffdd-\uffdf\uffe7\uffef-\ufffb\ufffe-\uffff]/.test(l)?c<=255?2:c<=65535?4:8:0)?l:2===p?"\\x"+b._lpad(c.toString(16),"0",2):4===p?"\\u"+b._lpad(c.toString(16),"0",4):"\\U"+b._lpad(c.toString(16),"0",8)}}return a+r+a},b._lpad=function(t,e,r){for("number"==typeof t&&(t=t.toString());t.length<r;)t=e+t;return t},b._type=function(t){return null===t?"none":!1===t||!0===t?"bool":void 0===t?"undefined":"number"==typeof t?Math.round(t)==t?"int":"float":"function"==typeof t?"function":"function"==typeof t.ul4type?t.ul4type():b.Protocol.get(t).ul4type()},b._rfind=function(t,e,r,n){void 0===r&&(r=null),void 0===n&&(n=null),null===r&&(r=0),null===n&&(n=t.length),r<0&&(r+=t.length),n<0&&(n+=t.length),r=b._bound(r,t.length),n=b._bound(n,t.length),0===r&&n===t.length||(t="string"==typeof t?t.substring(r,n):t.slice(r,n));var u=t.lastIndexOf(e);return-1!==u&&(u+=r),u},b._iter=function(t){if("string"==typeof t||b._islist(t))return{index:0,next:function(){return this.index<t.length?{value:t[this.index++],done:!1}:{done:!0}}};if(b._isiter(t))return t;if(null!==t&&"function"==typeof t.__iter__)return t.__iter__();if(b._ismap(t)){var r=[];return t.forEach(function(t,e){r.push(e)}),{index:0,next:function(){return this.index>=r.length?{done:!0}:{value:r[this.index++],done:!1}}}}if(b._isset(t)){var n=[];return t.forEach(function(t,e){n.push(t)}),{index:0,next:function(){return this.index>=n.length?{done:!0}:{value:n[this.index++],done:!1}}}}if(b._isul4set(t))return b._iter(t.items);if(b._isobject(t)){var e=[];for(var u in t)e.push(u);return{index:0,next:function(){return this.index>=e.length?{done:!0}:{value:e[this.index++],done:!1}}}}throw new b.TypeError(b._type(t)+" object is not iterable")};var t=function(){function t(){this.__id__=e++}return t.prototype.ul4type=function(){return this.constructor.name},t.prototype.__eq__=function(t){return this===t},t.prototype.__ne__=function(t){return!this.__eq__(t)},t.prototype.__bool__=function(){return!0},t}(),r=function(i){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0);var n=i.call(this)||this,u=Math.floor(1e6*(86400*t+e)+r);r=b.ModAST.prototype._do(u,1e6);var o=Math.floor(u/1e6);return e=b.ModAST.prototype._do(o,86400),t=Math.floor(o/86400),e<0&&(e+=86400,--t),n._microseconds=r,n._seconds=e,n._days=t,n}return Y(t,i),t}(b.Proto=t);b.TimeDelta=r;var n=function(u){function t(t,e,r){var n=u.call(this)||this;return n._date=new N(t,e-1,r),n}return Y(t,u),t.prototype.ul4type=function(){return"date"},t.prototype.__repr__=function(){return"@("+this.__str__()+")"},t.prototype.__str__=function(){return b._lpad(this._date.getFullYear(),"0",4)+"-"+b._lpad(this._date.getMonth()+1,"0",2)+"-"+b._lpad(this._date.getDate(),"0",2)},t.prototype.__eq__=function(t){return t instanceof b.Date&&this._date.getTime()===t._date.getTime()},t.prototype.__lt__=function(t){if(t instanceof b.Date)return this._date<t._date;b._unorderable("<",this,t)},t.prototype.__le__=function(t){if(t instanceof b.Date)return this._date<=t._date;b._unorderable("<=",this,t)},t.prototype.__gt__=function(t){if(t instanceof b.Date)return this._date>t._date;b._unorderable(">",this,t)},t.prototype.__ge__=function(t){if(t instanceof b.Date)return this._date>=t._date;b._unorderable(">=",this,t)},t.prototype.year=function(){return this._date.getFullYear()},t.prototype.month=function(){return this._date.getMonth()+1},t.prototype.day=function(){return this._date.getDate()},t}(t);b.Date=n;var u=function(s){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=s.call(this)||this;r.args=[],r.argNames={},r.remargs=null;for(var n=!1,u=r.remkwargs=null,o=0,i=t;o<i.length;o++){var a=i[o];n?(r.args.push({name:u,defaultValue:a}),n=!(r.argNames[u]=!0)):"="===a.substr(a.length-1)?(u=a.substr(0,a.length-1),n=!0):"**"===a.substr(0,2)?r.remkwargs=a.substr(2):"*"===a.substr(0,1)?r.remargs=a.substr(1):(r.args.push({name:a}),r.argNames[a]=!0)}return r}return Y(t,s),t.prototype.bindArray=function(t,e,r){for(var n=[],u=null!==t?t+"() ":"",o=0;o<this.args.length;++o){var i=this.args[o];if(o<e.length){if(r.hasOwnProperty(i.name))throw new b.ArgumentError(u+"argument "+b._repr(i.name)+" (position "+o+") specified multiple times");n.push(e[o])}else if(r.hasOwnProperty(i.name))n.push(r[i.name]);else{if(!i.hasOwnProperty("defaultValue"))throw new b.ArgumentError("required "+u+"argument "+b._repr(i.name)+" (position "+o+") missing");n.push(i.defaultValue)}}if(null===this.remargs){if(e.length>this.args.length){var a=null===t?"expected":t+"() expects";throw new b.ArgumentError(a+" at most "+this.args.length+" positional argument"+(1!=this.args.length?"s":"")+", "+e.length+" given")}}else n.push(e.slice(this.args.length));if(null===this.remkwargs){for(var s in r)if(!this.argNames[s])throw null===t?new b.ArgumentError("an argument named "+b._repr(s)+" isn't supported"):new b.ArgumentError(t+"() doesn't support an argument named "+b._repr(s))}else{var f=L._emptymap();for(var s in r)this.argNames[s]||L._setmap(f,s,r[s]);n.push(f)}return n},t}(t);b.Signature=u;var o=function(r){function t(t){var e=r.call(this)||this;return e._ul4onattrs=["pos"],e.pos=t,e}return Y(t,r),t.prototype.__getattr__=function(t){if("type"===t)return this.ul4type;if(0<=this._ul4onattrs.indexOf(t))return this[t];throw new b.AttributeError(this,t)},t.prototype.__setitem__=function(t,e){throw new b.TypeError("object is immutable")},t.prototype.__str__=function(){var t=[];return this._str(t),b._formatsource(t)},t.prototype.__repr__=function(){var t=[];return this._repr(t),b._formatsource(t)},t.prototype._handle_eval=function(t){try{return this._eval(t)}catch(t){if(!(t instanceof b.InternalException||t instanceof b.LocationError))throw new b.LocationError(this,t);throw t}},t.prototype._handle_eval_set=function(t,e){try{return this._eval_set(t,e)}catch(t){if(!(t instanceof b.LocationError))throw new b.LocationError(this,t);throw t}},t.prototype._eval_set=function(t,e){throw new b.LValueRequiredError},t.prototype._handle_eval_modify=function(t,e,r){try{return this._eval_modify(t,e,r)}catch(t){if(!(t instanceof b.LocationError))throw new b.LocationError(this,t);throw t}},t.prototype._eval_modify=function(t,e,r){throw new b.LValueRequiredError},t.prototype._repr=function(t){},t.prototype._str=function(t){},t.prototype.ul4ondump=function(t){for(var e=0,r=this._ul4onattrs;e<r.length;e++){var n=r[e];t.dump(this[n])}},t.prototype.ul4onload=function(t){for(var e=0,r=this._ul4onattrs;e<r.length;e++){this[r[e]]=t.load()}},t}(t),i=function(n){function t(t,e){var r=n.call(this,t)||this;return r.tag=t,r}return Y(t,n),t.prototype._str=function(t){t.push(this.tag.source.substring(this.pos.start,this.pos.stop).replace(/\r?\n/g," "))},t}(b.AST=o),a=function(u){function t(t,e,r){var n=u.call(this,t,e)||this;return n.value=r,n}return Y(t,u),t.prototype._repr=function(t){t.push("<ConstAST value="),t.push(b._repr(this.value)),t.push(">")},t.prototype._eval=function(t){return this.value},t}(b.CodeAST=i);b.ConstAST=a;var s=function(o){function t(t,e,r,n){var u=o.call(this,t,e)||this;return u._ul4onattrs=b.AST.prototype._ul4onattrs.concat(["tag"]),u.obj1=r,u.obj2=n,u}return Y(t,o),t.prototype._repr=function(t){t.push("<"),t.push(this.constructor.name),t.push(" obj1="),this.obj1._repr(t),t.push(" obj2="),this.obj2._repr(t),t.push(">")},t.prototype._eval=function(t){var e=this.obj1._handle_eval(t),r=this.obj2._handle_eval(t);return this._do(e,r)},t}(i),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.prototype._do=function(t,e){return b._mod(t,e)},e.prototype._ido=function(t,e){return this._do(t,e)},e}(b.BinaryAST=s);b.ModAST=f;var l=function(){function t(){}return t.ul4type=function(){return t.constructor.name},t.dir=function(){},t.get=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return b._isstr(t)?b.StrProtocol:b._islist(t)?b.ListProtocol:b._isdate(t)?b.DateProtocol:b._isset(t)?b.SetProtocol:b._ismap(t)?b.MapProtocol:b._isdatetime(t)?b.DateTimeProtocol:b._isobject(t)?b.ObjectProtocol:b.Protocol},t.getattr=function(t,e){if(null==t)throw new b.AttributeError(t,e);if("function"==typeof t.__getattr__)return t.__getattr__(e);if(this.attrs.has(e)){var r=this[e],n=new Function("return function "+r.name+" (...args: any[]) { return attr.apply(Protocol.attrs, [obj, ...args]); }");return n._ul4_name=r._ul4_name||r.name,n._ul4_signature=r._ul4_signature,n._ul4_needsobject=r._ul4_needsobject,n._ul4_needscontext=r._ul4_needscontext,n}throw new b.AttributeError(t,e)},t.hasattr=function(e,t){if(null==e)return!1;if("function"!=typeof e.__getattr__)return this.has(t);try{return e.__getattr__(t),!0}catch(t){if(t instanceof b.AttributeError&&t.obj===e)return!1;throw t}},t.attrs=L._emptyset(),t}(),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"dict"},e.getattr=function(r,t){var n;if("function"!=typeof(n=r&&"function"==typeof r.__getattr__?r.__getattr__(t):r[t]))return n;var e=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(r,t)};return e._ul4_name=n._ul4_name||n.name,e._ul4_signature=n._ul4_signature,e._ul4_needsobject=n._ul4_needsobject,e._ul4_needscontext=n._ul4_needscontext,e},e.get=function(t,e,r){void 0===r&&(r=null);var n=t[e];return void 0===n?r:n},e.items=function(t){var e=[];for(var r in t)e.push([r,t[r]]);return e},e.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},e.clear=function(t){for(var e in t)delete t[e]},e}(b.Protocol=l);b.ObjectProtocol=c,b.expose(b.ObjectProtocol.get,["key","default=",null]),b.expose(b.ObjectProtocol.items,[]),b.expose(b.ObjectProtocol.values,[]),b.expose(b.ObjectProtocol.clear,[]);var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"dict"},e.getattr=function(r,t){if(this.attrs.has(t)){var n=this[t],e=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.apply(this,[r].concat(t))};return e.name=n.name,e._ul4_name=n._ul4_name||n.name,e._ul4_signature=n._ul4_signature,e._ul4_needsobject=n._ul4_needsobject,e._ul4_needscontext=n._ul4_needscontext,e}return r.get(t)},e.prototype.get=function(t,e,r){return void 0===r&&(r=null),t.has(e)?t.get(e):r},e.prototype.items=function(t){var r=[];return t.forEach(function(t,e){r.push([e,t])}),r},e.prototype.values=function(t){var r=[];return t.forEach(function(t,e){r.push(t)}),r},e.prototype.update=function(t,e,r){return b._update(t,e,r)},e.prototype.clear=function(t){return t.clear(),null},e}(l);b.MapProtocol=p;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"set"},e.add=function(t,e){for(var r=0,n=e;r<n.length;r++){var u=n[r];t.add(u)}},e.clear=function(t){return t.clear(),null},e.attr=L._makeset("add","clear"),e}(l);b.SetProtocol=h,b.expose(b.SetProtocol.add,["*items"]),b.expose(b.SetProtocol.clear,[]);var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"datetime"},e.weekday=function(t){var e=t.getDay();return e?e-1:6},e.calendar=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=4),e=b._mod(e,7),r<1?r=1:7<r&&(r=7);for(var n=1;-1<=n;--n){var u=t.getFullYear()+n,o=new N(u,0,r),i=b._mod(b.DateTimeProtocol.weekday(o)-e,7),a=o.getFullYear(),s=o.getMonth(),f=o.getDate()-i,l=new N(a,s,f);if(t.getTime()>=l.getTime()){var c=b.SubAST.prototype._do(t,l);return[u,Math.floor(c.days()/7)+1,b.DateTimeProtocol.weekday(t)]}}},e.week=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=4),b.DateTimeProtocol.calendar(t,e,r)[1]},e.day=function(t){return t.getDate()},e.month=function(t){return t.getMonth()+1},e.year=function(t){return t.getFullYear()},e.hour=function(t){return t.getHours()},e.minute=function(t){return t.getMinutes()},e.second=function(t){return t.getSeconds()},e.microsecond=function(t){return 1e3*t.getMilliseconds()},e.mimeformat=function(t){return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][b.DateTimeProtocol.weekday(t)]+", "+b._lpad(t.getDate(),"0",2)+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getFullYear()+" "+b._lpad(t.getHours(),"0",2)+":"+b._lpad(t.getMinutes(),"0",2)+":"+b._lpad(t.getSeconds(),"0",2)+" GMT"},e.isoformat=function(t){var e=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),u=t.getHours(),o=t.getMinutes(),i=t.getSeconds(),a=t.getMilliseconds(),s=e+"-"+b._lpad(r.toString(),"0",2)+"-"+b._lpad(n.toString(),"0",2)+"T"+b._lpad(u.toString(),"0",2)+":"+b._lpad(o.toString(),"0",2)+":"+b._lpad(i.toString(),"0",2);return a&&(s+="."+b._lpad(a.toString(),"0",3)+"000"),s},e.yearday=function(t){var e=b._isleap(t)?1:0,r=t.getDate();switch(t.getMonth()){case 0:return r;case 1:return 31+r;case 2:return 59+e+r;case 3:return 59+e+31+r;case 4:return 59+e+31+30+r;case 5:return 59+e+31+30+31+r;case 6:return 59+e+31+30+31+30+r;case 7:return 59+e+31+30+31+30+31+r;case 8:return 59+e+31+30+31+30+31+31+r;case 9:return 59+e+31+30+31+30+31+31+30+r;case 10:return 59+e+31+30+31+30+31+31+30+31+r;case 11:return 59+e+31+30+31+30+31+31+30+31+30+r}},e}(l);b.DateTimeProtocol=_;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.prototype._do=function(t,e){if(t&&"function"==typeof t.__sub__)return t.__sub__(e);if(e&&"function"==typeof e.__rsub__)return e.__rsub__(t);if(b._isdate(t)&&b._isdate(e))return this._date_sub(t,e);if(b._isdatetime(t)&&b._isdatetime(e))return this._datetime_sub(t,e);if(null===t||null===e)throw new b.TypeError(b._type(this.obj1)+" - "+b._type(this.obj2)+" is not supported");return t-e},e.prototype._date_sub=function(t,e){return this._datetime_sub(t._date,e._date)},e.prototype._datetime_sub=function(t,e){var r=t<e;if(r){var n=t;t=e,e=n}for(var u=t.getFullYear(),o=b.DateTimeProtocol.yearday(t),i=e.getFullYear(),a=b.DateTimeProtocol.yearday(e),s=0;i<u;)s+=b.DateProtocol.yearday(b._date(i,12,31)),++i;s+=o-a;var f=t.getHours(),l=t.getMinutes(),c=t.getSeconds(),p=e.getHours(),h=e.getMinutes(),_=c-e.getSeconds()+60*(l-h+60*(f-p)),d=t.getMilliseconds()-e.getMilliseconds();return r&&(s=-s,_=-_,d=-d),new b.TimeDelta(s,_,1e3*d)},e}(s);b.SubAST=d;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"date"},e.weekday=function(t){return b.DateTimeProtocol.weekday(t._date)},e.calendar=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=4),b.DateTimeProtocol.calendar(t._date,e,r)},e.week=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=4),b.DateProtocol.calendar(t,e,r)[1]},e.day=function(t){return t._date.getDate()},e.month=function(t){return t._date.getMonth()+1},e.year=function(t){return t._date.getFullYear()},e.mimeformat=function(t){var e=t._date;return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][b.DateTimeProtocol.weekday(e)]+", "+b._lpad(e.getDate(),"0",2)+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+e.getFullYear()},e.isoformat=function(t){var e=t._date;return e.getFullYear()+"-"+b._lpad((e.getMonth()+1).toString(),"0",2)+"-"+b._lpad(e.getDate().toString(),"0",2)},e.yearday=function(t){return b.DateTimeProtocol.yearday(t._date)},e}(l);b.DateProtocol=g;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"list"},e.append=function(t,e){for(var r=0,n=e;r<n.length;r++){var u=n[r];t.push(u)}return null},e.insert=function(t,e,r){e<0&&(e+=t.length);for(var n=0,u=r;n<u.length;n++){var o=u[n];t.splice(e++,0,o)}return null},e.pop=function(t,e){e<0&&(e+=t.length);var r=t[e];return t.splice(e,1),r},e.count=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._count(t,e,r,n)},e.find=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._find(t,e,r,n)},e.rfind=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._rfind(t,e,r,n)},e.attrs=L._makeset("append","insert","pop","count","find","rfind"),e}(l);b.ListProtocol=v,b.expose(b.ListProtocol.append,["*items"]),b.expose(b.ListProtocol.insert,["pos","*items"]),b.expose(b.ListProtocol.pop,["pos=",-1]),b.expose(b.ListProtocol.count,["sub","start=",null,"end=",null]),b.expose(b.ListProtocol.find,["sub","start=",null,"end=",null]),b.expose(b.ListProtocol.rfind,["sub","start=",null,"end=",null]);var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.ul4type=function(){return"str"},e.count=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._count(t,e,r,n)},e.find=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._find(t,e,r,n)},e.rfind=function(t,e,r,n){return void 0===r&&(r=null),void 0===n&&(n=null),b._rfind(t,e,r,n)},e.replace=function(t,e,r,n){void 0===n&&(n=null),null===n&&(n=t.length);for(var u=[];t.length;){var o=t.indexOf(e);if(-1===o||!n--){u.push(t);break}u.push(t.substr(0,o)),u.push(r),t=t.substr(o+e.length)}return u.join("")},e.strip=function(t,e){if(void 0===e&&(e=null),"string"!=typeof(e=e||" \r\n\t"))throw new b.TypeError("strip() requires a string argument");for(;t&&0<=e.indexOf(t[0]);)t=t.substr(1);for(;t&&0<=e.indexOf(t[t.length-1]);)t=t.substr(0,t.length-1);return t},e.lstrip=function(t,e){if(void 0===e&&(e=null),"string"!=typeof(e=e||" \r\n\t"))throw new b.TypeError("lstrip() requires a string argument");for(;t&&0<=e.indexOf(t[0]);)t=t.substr(1);return t},e.rstrip=function(t,e){if(void 0===e&&(e=null),"string"!=typeof(e=e||" \r\n\t"))throw new b.TypeError("rstrip() requires a string argument");for(;t&&0<=e.indexOf(t[t.length-1]);)t=t.substr(0,t.length-1);return t},e.split=function(t,e,r){if(void 0===e&&(e=null),void 0===r&&(r=null),null!==e&&"string"!=typeof e)throw new b.TypeError("split() requires a string");if(null===r){var n=t.split(null!==e?e:/[ \n\r\t]+/);return null===e&&(n.length&&!n[0].length&&n.splice(0,1),n.length&&!n[n.length-1].length&&n.splice(-1)),n}if(null!==e){for(n=[];t.length;){var u=t.indexOf(e);if(-1===u||!r--){n.push(t);break}n.push(t.substr(0,u)),t=t.substr(u+e.length)}return n}for(n=[];t.length;){t=b.StrProtocol.lstrip(t,null);var o=void 0;(o=r--?t.split(/[ \n\r\t]+/,1)[0]:t).length&&n.push(o),t=t.substr(o.length)}return n},e.rsplit=function(t,e,r){if(void 0===e&&(e=null),void 0===r&&(r=null),null!==e&&"string"!=typeof e)throw new b.TypeError("rsplit() requires a string as second argument");if(null===r){var n=t.split(null!==e?e:/[ \n\r\t]+/);return null===e&&(n.length&&!n[0].length&&n.splice(0,1),n.length&&!n[n.length-1].length&&n.splice(-1)),n}if(null!==e){for(n=[];t.length;){var u=t.lastIndexOf(e);if(-1===u||!r--){n.unshift(t);break}n.unshift(t.substr(u+e.length)),t=t.substr(0,u)}return n}for(n=[];t.length;){t=b.StrProtocol.rstrip(t);var o=void 0;(o=r--?(o=t.split(/[ \n\r\t]+/))[o.length-1]:t).length&&n.unshift(o),t=t.substr(0,t.length-o.length)}return n},e.splitlines=function(t,e){void 0===e&&(e=!1);for(var r,n=[],u=t.length,o=0,i=0;;){if(u<=o)return i!=o&&n.push(t.substring(i)),n;var a=(void 0,"\n"===(r=t[0])||"\v"==r||"\f"==r||""==r||""==r||""==r||""==r||"\u2028"==r||"\u2029"==r?1:"\r"===r?0==u-1?1:"\n"===t[1]?2:1:0);if(a){var s=o+(e?a:0);n.push(t.substring(i,s)),i=o+=a}else++o}},e.lower=function(t){return t.toLowerCase()},e.upper=function(t){return t.toUpperCase()},e.capitalize=function(t){return t.length&&(t=t[0].toUpperCase()+t.slice(1).toLowerCase()),t},e.join=function(t,e){for(var r=[],n=b._iter(e);;){var u=n.next();if(u.done)break;r.push(u.value)}return r.join(t)},e.startswith=function(t,e){if("string"==typeof e)return t.substr(0,e.length)===e;if(b._islist(e)){for(var r=0,n=e;r<n.length;r++){var u=n[r];if(t.substr(0,u.length)===u)return!0}return!1}throw new b.TypeError("startswith() argument must be string")},e.endswith=function(t,e){if("string"==typeof e)return t.substr(t.length-e.length)===e;if(b._islist(e)){for(var r=0,n=e;r<n.length;r++){var u=n[r];if(t.substr(t.length-u.length)===u)return!0}return!1}throw new b.TypeError("endswith() argument must be string or list of strings")},e.attrs=L._makeset("split","rsplit","splitlines","strip","lstrip","rstrip","upper","lower","capitalize","startswith","endswith","replace","count","find","rfind","join"),e}(l);b.StrProtocol=y,b.expose(b.StrProtocol.count,["sub","start=",null,"end=",null]),b.expose(b.StrProtocol.find,["sub","start=",null,"end=",null]),b.expose(b.StrProtocol.rfind,["sub","start=",null,"end=",null]),b.expose(b.StrProtocol.replace,["old","new","count=",null]),b.expose(b.StrProtocol.strip,["chars=",null]),b.expose(b.StrProtocol.lstrip,["chars=",null]),b.expose(b.StrProtocol.rstrip,["chars=",null]),b.expose(b.StrProtocol.split,["sep=",null,"count=",null]),b.expose(b.StrProtocol.rsplit,["sep=",null,"count=",null]),b.expose(b.StrProtocol.splitlines,["keepends=",!1]),b.expose(b.StrProtocol.lower,[]),b.expose(b.StrProtocol.upper,[]),b.expose(b.StrProtocol.capitalize,[]),b.expose(b.StrProtocol.join,["iterable"]),b.expose(b.StrProtocol.startswith,["prefix"]),b.expose(b.StrProtocol.endswith,["suffix"]);var m=function(){function t(){this.__type__="set"}return t.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,n=t;r<n.length;r++){var u=n[r];this.items[u]=!0}},t.prototype.clear=function(){this.items={}},t.prototype.has=function(t){return!!this.items[t]},t.prototype.__getattr__=function(t){var e=this;switch(t){case"add":return b.expose(["*items"],function(t){e.add.apply(e,t)});default:throw new b.AttributeError(this,t)}},t.prototype.__contains__=function(t){return this.items[t]||!1},t.prototype.__bool__=function(){for(var t in this.items)if(this.items.hasOwnProperty(t))return!0;return!1},t.prototype.__repr__=function(){var t=[];t.push("{");var e=0;for(var r in this.items)this.items.hasOwnProperty(r)&&(e++&&t.push(", "),t.push(b._repr(r)));return e||t.push("/"),t.push("}"),t.join("")},t.prototype.__eq__=function(t){if(b._isset(t)){var e=0;for(var r in this.items){if(!t.has(r))return!1;++e}return t.size==e}if(b._isul4set(t)){e=0;for(var r in this.items){if(!t[r])return!1;++e}for(var r in t.items)--e;return 0==e}return!1},t.prototype.__le__=function(t){if(b._isset(t)){for(var e in this.items)if(!t.has(e))return!1;return!0}if(b._isul4set(t)){for(var e in this.items)if(!t.items[e])return!1;return!0}b._unorderable("<",this,t)},t.prototype.__ge__=function(e){if(b._isset(e)){var r=!0;return e.forEach(function(t){e.items[t]||(r=!1)}),r}if(b._isul4set(e)){for(var t in e.items)if(!this.items[t])return!1;return!0}b._unorderable("<=",this,e)},t}();b._Set=m;var w=function(n){function t(t,e){var r=n.call(this)||this;return r.start=t,r.stop=e,r}return Y(t,n),t.prototype.__repr__=function(){return"slice("+b._repr(this.start)+", "+b._repr(this.stop)+")"},t.prototype.__getattr__=function(t){switch(t){case"start":return this.start;case"stop":return this.stop;default:throw new b.AttributeError(this,t)}},t}(t);b.slice=w;var x=function(){function t(t){null==t&&(t={}),this.vars=t,this.indents=[],this.escapes=[],this._output=[]}return t.prototype.inheritvars=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},t.prototype.withindent=function(t){var e=Object.create(this);return null!==t&&(e.indents=this.indents.slice(),e.indents.push(t)),e},t.prototype.replaceoutput=function(){var t=Object.create(this);return t._output=[],t},t.prototype.clone=function(t){return Object.create(this)},t.prototype.output=function(t){for(var e=0,r=this.escapes;e<r.length;e++){t=(0,r[e])(t)}this._output.push(t)},t.prototype.getoutput=function(){return this._output.join("")},t.prototype.get=function(t){return this.vars[t]},t.prototype.set=function(t,e){this.vars[t]=e},t}();b.Context=x;var S=function(o){function t(t,e,r,n){var u=o.call(this,r)||this;return u.template=t,u.tag=e,u.codepos=n,u}return Y(t,o),t.prototype._eval=function(){return null},t.prototype.__getattr__=function(t){switch(t){case"template":return this.template;case"tag":return this.tag;case"text":return this.text;case"code":return this.code;default:return o.prototype.__getattr__.call(this,t)}},t}(o);b.Tag=S,Object.defineProperty(b.Tag.prototype,"text",{get:function(){return void 0!==this.template?this.template.source.substring(this.pos.start,this.pos.stop):null}}),Object.defineProperty(b.Tag.prototype,"code",{get:function(){return void 0!==this.template?this.template.source.substring(this.codepos.start,this.codepos.stop):null}});var j=function(o){function t(t,e,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=255);var u=o.call(this)||this;return u._r=t,u._g=e,u._b=r,u._a=n,u}return Y(t,o),t.prototype.__repr__=function(){var t=b._lpad(this._r.toString(16),"0",2),e=b._lpad(this._g.toString(16),"0",2),r=b._lpad(this._b.toString(16),"0",2),n=b._lpad(this._a.toString(16),"0",2);return 255!==this._a?t[0]===t[1]&&e[0]===e[1]&&r[0]===r[1]&&n[0]===n[1]?"#"+t[0]+e[0]+r[0]+n[0]:"#"+t+e+r+n:t[0]===t[1]&&e[0]===e[1]&&r[0]===r[1]?"#"+t[0]+e[0]+r[0]:"#"+t+e+r},t.prototype.__str__=function(){if(255!==this._a)return"rgba("+this._r+", "+this._g+", "+this._b+", "+this._a/255+")";var t=b._lpad(this._r.toString(16),"0",2),e=b._lpad(this._g.toString(16),"0",2),r=b._lpad(this._b.toString(16),"0",2);b._lpad(this._a.toString(16),"0",2);return t[0]===t[1]&&e[0]===e[1]&&r[0]===r[1]?"#"+t[0]+e[0]+r[0]:"#"+t+e+r},t.prototype.__iter__=function(){return{obj:this,index:0,next:function(){return 0==this.index?(++this.index,{value:this.obj._r,done:!1}):1==this.index?(++this.index,{value:this.obj._g,done:!1}):2==this.index?(++this.index,{value:this.obj._b,done:!1}):3==this.index?(++this.index,{value:this.obj._a,done:!1}):{done:!0}}}},t.prototype.__getattr__=function(t){var e=this;switch(t){case"r":var r=function(){return e._r};return b.expose(r,[]),r;case"g":var n=function(){return e._g};return b.expose(n,[]),n;case"b":var u=function(){return e._b};return b.expose(u,[]),u;case"a":var o=function(){return e._a};return b.expose(o,[]),o;case"lum":var i=function(){return e.lum()};return b.expose(i,[]),i;case"hls":var a=function(){return e.hls()};return b.expose(a,[]),a;case"hlsa":var s=function(){return e.hlsa()};return b.expose(s,[]),s;case"hsv":var f=function(){return e.hsv()};return b.expose(f,[]),f;case"hsva":var l=function(){return e.hsva()};return b.expose(l,[]),l;case"witha":var c=function(t){return e.witha(t)};return b.expose(c,["a"]),c;case"withlum":var p=function(t){return e.withlum(t)};return b.expose(p,["lum"]),p;case"abslum":var h=function(t){return e.abslum(t)};return b.expose(h,["lum"]),h;case"rellum":var _=function(t){return e.rellum(t)};return b.expose(_,["lum"]),_;default:throw new b.AttributeError(this,t)}},t.prototype.__getitem__=function(t){switch(t<0&&(t+=4),t){case 0:return this._r;case 1:return this._g;case 2:return this._b;case 3:return this._a;default:throw new b.IndexError(this,t)}},t.prototype.__eq__=function(t){return t instanceof b.Color&&(this._r==t._r&&this._g==t._g&&this._b==t._b&&this._a==t._a)},t.prototype.r=function(){return this._r},t.prototype.g=function(){return this._g},t.prototype.b=function(){return this._b},t.prototype.a=function(){return this._a},t.prototype.lum=function(){return this.hls()[1]},t.prototype.hls=function(){var t,e,r,n,u=this._r/255,o=this._g/255,i=this._b/255,a=Math.max(u,o,i),s=Math.min(u,o,i);return t=(s+a)/2,s==a?[0,t,0]:(e=(a-u)/(a-s),r=(a-o)/(a-s),n=(a-i)/(a-s),[(u==a?n-r:o==a?2+e-n:4+r-e)/6%1,t,t<=.5?(a-s)/(a+s):(a-s)/(2-a-s)])},t.prototype.hlsa=function(){return this.hls().concat(this._a/255)},t.prototype.hsv=function(){var t=this._r/255,e=this._g/255,r=this._b/255,n=Math.max(t,e,r),u=Math.min(t,e,r);if(u==n)return[0,0,n];var o=(n-t)/(n-u),i=(n-e)/(n-u),a=(n-r)/(n-u);return[(t==n?a-i:e==n?2+o-a:4+i-o)/6%1,(n-u)/n,n]},t.prototype.hsva=function(){return this.hsv().concat(this._a/255)},t.prototype.witha=function(t){if("number"!=typeof t)throw new b.TypeError("witha() requires a number");return new b.Color(this._r,this._g,this._b,t)},t.prototype.withlum=function(t){if("number"!=typeof t)throw new b.TypeError("witha() requires a number");var e=this.hlsa();return b._hls(e[0],t,e[2],e[3])},t.prototype.ul4type=function(){return"color"},t}(t);b.Color=j,b.expose(b.Color.prototype.r,[]),b.expose(b.Color.prototype.g,[]),b.expose(b.Color.prototype.b,[]),b.expose(b.Color.prototype.a,[]),b.expose(b.Color.prototype.lum,[]),b.expose(b.Color.prototype.hls,[]),b.expose(b.Color.prototype.hlsa,[]),b.expose(b.Color.prototype.hsv,[]),b.expose(b.Color.prototype.hsva,[]),b.expose(b.Color.prototype.witha,["a"]),b.expose(b.Color.prototype.withlum,["lum"]);var k=function(r){function t(t){void 0===t&&(t=0);var e=r.call(this)||this;return e._months=t,e}return Y(t,r),t}(t);b.MonthDelta=k;var E=function(r){function t(t){var e=r.call(this,t)||this;return e.name="UL4 Exception",e}return Y(t,r),t.prototype.__getattr__=function(t){switch(t){case"cause":return this.cause;default:throw new b.AttributeError(this,t)}},t}(Error),P=function(n){function t(t,e){var r=n.call(this,"index "+b._repr(e)+" out of range")||this;return r.obj=t,r.index=e,r}return Y(t,n),t.prototype.toString=function(){return"index "+this.index+" out of range for "+b._type(this.obj)},t}(b.Exception=E);b.IndexError=P;var T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e}(b.Exception),M=function(t){function e(){return t.call(this,"lvalue required")||this}return Y(e,t),e}(b.SyntaxError=T);b.LValueRequiredError=M;var D=function(n){function t(t,e){var r=n.call(this,"nested exception in "+b._repr(t))||this;return r.location=t,r.cause=e,r}return Y(t,n),t}(E);b.LocationError=D;var O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e}(E);b.InternalException=O;var A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e}(E);b.ArgumentError=A;var q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e}(E);b.TypeError=q;var C=function(n){function t(t,e){var r=n.call(this,"object of type "+b._type(t)+" has no attribute "+b._repr(e))||this;return r.obj=t,r.attrname=e,r}return Y(t,n),t}(E);b.AttributeError=C;var F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e}(b.Exception);b.ValueError=F}(_.ul4||(_.ul4={})),function(h){h._registry={},h.register=function(t,e){e.prototype.ul4onname=t,h._registry[t]=e},h.dumps=function(t,e){var r=new n(e);return r.dump(t),r.finish()},h.loads=function(t,e){return void 0===e&&(e=null),new r(t,e).load()};var n=function(){function t(t){void 0===t&&(t=null),this.data=[],this._level=0,this._strings2index={},this._ids2index={},this._backrefs=0}return t.prototype._line=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(null!==this.indent)for(var n=0;n<this._level;++n)this.data.push(this.indent);else this.data.length&&this.data.push(" ");if(this.data.push(t),e.length){var u=this.indent;this.indent=null;for(var o=0,i=e;o<i.length;o++){var a=i[o];this.dump(a)}this.indent=u}null!==this.indent&&this.data.push("\n")},t.prototype.finish=function(){return this.data.join("")},t.prototype.dump=function(t){if(null===t)this._line("n");else if("boolean"==typeof t)this._line(t?"bT":"bF");else if("number"==typeof t){var e=Math.round(t)==t?"i":"f";this._line(e+t)}else if("string"==typeof t){if(void 0!==(n=this._strings2index[t]))this._line("^"+n);else{this._strings2index[t]=this._backrefs++;var r=_.ul4._str_repr(t).replace("<","\\x3c");this._line("S"+r)}}else if(_.ul4._iscolor(t))this._line("c",t.r(),t.g(),t.b(),t.a());else if(_.ul4._isdate(t))this._line("x",t.year(),t.month(),t.day());else if(_.ul4._isdatetime(t))this._line("z",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),1e3*t.getMilliseconds());else if(_.ul4._istimedelta(t))this._line("t",t.days(),t.seconds(),t.microseconds());else if(_.ul4._ismonthdelta(t))this._line("m",t.months());else if(t instanceof _.ul4.slice)this._line("r",t.start,t.stop);else if(t.ul4onname&&t.ul4ondump){if(t.__id__){var n;if(void 0!==(n=this._ids2index[t.__id__]))return void this._line("^"+n);this._ids2index[t.__id__]=this._backrefs++}this._line("O",t.ul4onname),++this._level,t.ul4ondump(this),--this._level,this._line(")")}else if(_.ul4._islist(t)){this._line("l"),++this._level;for(var u=0,o=t;u<o.length;u++){var i=o[u];this.dump(i)}--this._level,this._line("]")}else if(_.ul4._ismap(t)){this._line("e"),++this._level;for(var a=0,s=t.entries();a<s.length;a++){var f=s[a],l=f[0],c=f[1];this.dump(l),this.dump(c)}--this._level,this._line("}")}else if(_.ul4._isdict(t)){for(var l in this._line("d"),++this._level,t)this.dump(l),this.dump(t[l]);--this._level,this._line("}")}else{if(!_.ul4._isset(t))throw new _.ul4.ValueError("can't create UL4ON dump of object "+_.ul4._repr(t));this._line("y"),++this._level;for(var p=0,h=t.values();p<h.length;p++){i=h[p];this.dump(i)}--this._level,this._line("}")}},t}();h.Encoder=n;var r=function(){function t(t,e){void 0===e&&(e=null),this.data=t||null,this.registry=e,this.pos=0,this.backrefs=[],this.stack=[]}return t.prototype.readchar=function(){return this.pos>=this.data.length?null:this.data.charAt(this.pos++)},t.prototype.readcharoreof=function(){return this.pos>=this.data.length?null:this.data.charAt(this.pos++)},t.prototype.readblackchar=function(){for(var t=/\s/;;){if(this.pos>=this.data.length)throw"UL4 decoder at EOF at position "+this.pos+" with path "+this.stack.join("/");var e=this.data.charAt(this.pos++);if(!e.match(t))return e}},t.prototype.read=function(t){this.pos+t>this.data.length&&(t=this.data.length-this.pos);var e=this.data.substring(this.pos,this.pos+t);return this.pos+=t,e},t.prototype.backup=function(){--this.pos},t.prototype.readnumber=function(){for(var t=/[-+0123456789.eE]/,e="";;){var r=this.readcharoreof();if(null===r||!r.match(t)){var n=parseFloat(e);if(isNaN(n))throw"invalid number, got "+_.ul4._repr("value")+" at position "+this.pos+" with path "+this.stack.join("/");return n}e+=r}},t.prototype._beginfakeloading=function(){var t=this.backrefs.length;return this.backrefs.push(null),t},t.prototype._endfakeloading=function(t,e){this.backrefs[t]=e},t.prototype._readescape=function(t,e){var r=this.read(e);if(r.length!=e)throw"broken escape "+_.ul4._repr("\\"+t+r)+" at position "+this.pos+" with path "+this.stack.join("/");var n=parseInt(r,16);if(isNaN(n))throw"broken escape "+_.ul4._repr("\\"+t+r)+" at position "+this.pos+" with path "+this.stack.join("/");return String.fromCharCode(n)},t.prototype.load=function(){var t,e=this.readblackchar();switch(e){case"^":return this.backrefs[this.readnumber()];case"n":case"N":return"N"===e&&this.backrefs.push(null),null;case"b":case"B":if("T"===(t=this.readchar()))t=!0;else{if("F"!==t)throw"wrong value for boolean, expected 'T' or 'F', got "+_.ul4._repr(t)+" at position "+this.pos+" with path "+this.stack.join("/");t=!1}return"B"===e&&this.backrefs.push(t),t;case"i":case"I":case"f":case"F":return t=this.readnumber(),"I"!==e&&"F"!==e||this.backrefs.push(t),t;case"s":case"S":t=[];for(var r=this.readblackchar();;){var n=this.readchar();if(n==r)break;if("\\"==n){var u=this.readchar();"\\"==u?t.push("\\"):"n"==u?t.push("\n"):"r"==u?t.push("\r"):"t"==u?t.push("\t"):"f"==u?t.push("\f"):"b"==u?t.push("\b"):"a"==u?t.push(""):"'"==u?t.push("'"):'"'==u?t.push('"'):"x"==u?t.push(this._readescape("x",2)):"u"==u?t.push(this._readescape("u",4)):"U"==u?t.push(this._readescape("U",8)):t.push("\\"+u)}else t.push(n)}return t=t.join(""),"S"===e&&this.backrefs.push(t),t;case"c":case"C":return t=new _.ul4.Color,"C"===e&&this.backrefs.push(t),t._r=this.load(),t._g=this.load(),t._b=this.load(),t._a=this.load(),t;case"x":case"X":var o=this.load(),i=this.load(),a=this.load();return t=new _.ul4.Date(o,i,a),"X"===e&&this.backrefs.push(t),t;case"z":case"Z":return(t=new Date).setFullYear(this.load()),t.setDate(1),t.setMonth(this.load()-1),t.setDate(this.load()),t.setHours(this.load()),t.setMinutes(this.load()),t.setSeconds(this.load()),t.setMilliseconds(this.load()/1e3),"Z"===e&&this.backrefs.push(t),t;case"t":case"T":return(t=new _.ul4.TimeDelta)._days=this.load(),t._seconds=this.load(),t._microseconds=this.load(),"T"===e&&this.backrefs.push(t),t;case"r":case"R":return t=new _.ul4.slice,"R"===e&&this.backrefs.push(t),t.start=this.load(),t.stop=this.load(),t;case"m":case"M":return t=new _.ul4.MonthDelta,"M"===e&&this.backrefs.push(t),t._months=this.load(),t;case"l":case"L":for(this.stack.push("list"),t=[],"L"===e&&this.backrefs.push(t);"]"!==(e=this.readblackchar());)this.backup(),t.push(this.load());return this.stack.pop(),t;case"d":case"D":case"e":case"E":if(!L._havemap&&("e"==e||"E"==e))throw"ordered dictionaries are not supported at position "+this.pos+" with path "+this.stack.join("/");for(t=L._emptymap(),this.stack.push("d"===e||"D"===e?"dict":"odict"),"D"!==e&&"E"!==e||this.backrefs.push(t);"}"!==(e=this.readblackchar());){this.backup();var s=this.load(),f=this.load();L._setmap(t,s,f)}return this.stack.pop(),t;case"y":case"Y":for(this.stack.push("set"),t=L._makeset(),"Y"===e&&this.backrefs.push(t);"}"!==(e=this.readblackchar());)this.backup(),t.add(this.load());return this.stack.pop(),t;case"o":case"O":var l=void 0;"O"===e&&(l=this._beginfakeloading());var c=this.load();this.stack.push(c);var p=void 0;if(null!==this.registry?void 0===(p=this.registry[c])&&(p=h._registry[c]):p=h._registry[c],void 0===p)throw new _.ul4.ValueError("can't load object of type "+_.ul4._repr(c)+" at position "+this.pos+" with path "+this.stack.join("/"));if(t=new p,"O"===e&&this._endfakeloading(l,t),t.ul4onload(this),")"!==(e=this.readblackchar()))throw new _.ul4.ValueError("object terminator ')' for object of type '"+c+"' expected, got "+_.ul4._repr(e)+" at position "+this.pos+" with path "+this.stack.join("/"));return this.stack.pop(),t;default:throw new _.ul4.ValueError("unknown typecode "+_.ul4._repr(e)+" at position "+this.pos+" with path "+this.stack.join("/"))}},t.prototype.loadcontent=function(){var e=this;return{next:function(){var t=e.readblackchar();return e.backup(),")"==t?{done:!0}:{done:!1,value:e.load()}}}},t}();h.Decoder=r}(_.ul4on||(_.ul4on={})),_}({});
//# sourceMappingURL=ul4.js.map
